"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(i,n){var o=this;if(_classCallCheck(this,e),this.options=n,this.options.filter&&(this.options.filter=this.options.filter.bind(this)),this.$input=t(i),this.$input.addClass("typeahead"),this.$input.attr("autocomplete","off"),this.$input.data("value-field")?this.$valueField=t(this.$input.data("value-field")):"string"==typeof this.options.valueField?this.$valueField=t(this.options.valueField):this.options.valueField&&this.options.valueField.length&&(this.$valueField=this.options.valueField),this.datasource=this.$input.data("source"),this.datasource||(this.datasource=this.options.dataSource),this.data=null,this.$items=t('<ul class="items dropdown-menu typeahead-menu" style="display:none;" role="menu"></ul>'),this.$items.insertAfter(this.$input),this.options.appendToBody){var s=""+1e4*Math.random()*(new Date).getTime()*window.outerHeight;this.$items.attr("id",s),this.$input.attr("dd-menu",s),this.$items.detach().appendTo("body")}var a=this;this.$input[0].addEventListener(this.options.searchOn,function(){a.search(this.value)}),this.$input.click(function(){o.data&&o.data.length&&(o.open=!0)}),this.$input.on("keydown",function(t){40===t.keyCode&&a.$items.children().first().focus()}),this.$items.on("keydown",function(e){40===e.keyCode?t(document.activeElement).next().focus():38===e.keyCode?t(document.activeElement).prev().focus():9===e.keyCode&&e.preventDefault()}),t("body").click(function(){var e=t(document.activeElement);e.is(o.$input)||e.is(o.$items)||o.$items.find(e).length||(o.open=!1)}),document.addEventListener("keydown",function(t){27===t.keyCode&&(o.open=!1)}),document.addEventListener("click",function(t){console.log(t.target)}),this.open=!1}return _createClass(e,[{key:"search",value:function(t){var e=this;t||(t=""),this.selected=null;this.options.getMethod(this.datasource,{value:t}).then(function(t){e.data=t,e.buildDropdownItems(void 0),e.open=!0})}},{key:"buildDropdownItems",value:function(t){if(this.destroyDropdownItems(),t&&t.length){var e=this;t.forEach(function(t){var i=document.createElement("li");i.setAttribute("value",t[e.options.valueProperty]),i.setAttribute("tabindex","-1"),i.innerHTML='<a href="#">'+t[e.options.nameProperty]+"</a>";var n=function(i){e.$input.val(t[e.options.nameProperty]),e.selected=t,e.open=!1};i.addEventListener("click",n),i.addEventListener("keydown",function(t){13===t.keyCode&&(n(),e.$input.focus(),t.preventDefault())}),e.$items.append(i)})}}},{key:"destroyDropdownItems",value:function(){this.$items.children().remove()}},{key:"toggleOpen",value:function(){this.open=!this.open}},{key:"setMenuDirection",value:function(){var e=this.$input.offset(),i=this.$input.outerHeight(),n=parseInt(this.$input.css("margin-top")),o=this.$items.outerHeight(),s=t(window).height(),a=e.top+i+o>s,u=e.top-t(window).scrollTop()-o>0;a&&u?this.$items.offset({top:e.top-o-n,left:e.left}):this.$items.offset({top:e.top+i+n,left:e.left})}},{key:"open",get:function(){return!!this.$input.attr("open")},set:function(t){t?this.$input.attr("open",""):this.$input.removeAttr("open"),this.open?(this.buildDropdownItems(this.data),this.$items.show(),this.setMenuDirection()):(this.$items.hide(),this.destroyDropdownItems())}},{key:"selected",get:function(){return this.$input.data("selected")},set:function(t){var e=this;if(t||(t={}),"object"!==(void 0===t?"undefined":_typeof(t))&&this.data){isNaN(+t)||(t=+t);var i=this.data.filter(function(i){return i[e.options.valueProperty]===t});i&&i.length&&i[0]&&(t=i[0])}this.$input[0].setAttribute("selected",t[this.options.valueProperty]||""),this.$input.data("selected",t),this.$valueField&&this.$valueField.val(t[this.options.valueProperty]||""),this.$input.trigger("change")}}]),e}(),i={nameProperty:"name",valueProperty:"value",valueField:null,dataSource:null,searchOn:"input",appendToBody:!1,getMethod:t.get};t.fn.typeahead=function(n){return this.each(function(){var o=t(this),s=o.data("typeahead"),a="object"===(void 0===n?"undefined":_typeof(n))&&n;if(!s){var u=t.extend({},i,a),r=new e(this,u);o.data("typeahead",r)}}),this},t(function(){t('[data-provide="softec-typeahead"]').typeahead()})}(window.jQuery);